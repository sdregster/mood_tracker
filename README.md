# Трекер настроения

Проект представляет собой веб-сервис для визуализации данных о настроении, экспортированных из приложения Daylio. Состоит из двух компонентов:
- FastAPI веб-приложение для отображения графика настроения
- Telegram бот для загрузки CSV-файлов из Daylio

## Требования

- Docker и Docker Compose
- Telegram аккаунт для создания бота
- Приложение Daylio для экспорта данных

## Установка и настройка

### 1. Клонирование репозитория

```bash
git clone <URL-репозитория>
cd mood_tracker
```

### 2. Создание Telegram бота через BotFather

1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям, чтобы создать нового бота:
   - Укажите имя бота (например, "Mood Tracker Bot")
   - Укажите уникальное имя пользователя, заканчивающееся на "bot" (например, "my_mood_tracker_bot")
4. BotFather предоставит вам токен доступа к API в формате `123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ`
5. Сохраните этот токен - он понадобится для настройки проекта

### 3. Настройка переменных окружения

Создайте файл `.env` в корне проекта:

```
BOT_TOKEN=ваш_токен_от_BotFather
```

### 4. Запуск проекта

```bash
docker compose up --build
```

После запуска приложение будет доступно по адресу http://localhost:10000

## Использование

### Экспорт данных из Daylio

1. Откройте Daylio на телефоне
2. Перейдите в раздел "Больше" (или "More")
3. Выберите "Экспорт Записей" (или "Export Entries")
4. Выберите формат "CSV (таблица)"
5. Следуйте инструкциям приложения для экспорта
6. Отправьте полученный CSV-файл своему Telegram боту

### Загрузка данных через Telegram бота

1. Откройте чат с вашим ботом в Telegram
2. Отправьте боту CSV-файл, экспортированный из Daylio
3. Бот подтвердит загрузку сообщением "Загружено: 200"

### Просмотр графика настроения

1. Откройте браузер и перейдите на http://localhost:10000
2. Вы увидите график вашего настроения, построенный на основе данных из Daylio

## Структура проекта

- `main.py` - FastAPI веб-приложение
- `bot.py` - Telegram бот для приема файлов
- `static/index.html` - Веб-страница с графиком
- `Dockerfile` - Конфигурация контейнера для FastAPI
- `Dockerfile.bot` - Конфигурация контейнера для бота
- `docker-compose.yml` - Конфигурация для запуска сервисов
- `requirements.txt` - Зависимости проекта
- `data/mood.csv` - Файл с данными о настроении

## Особенности работы с данными Daylio

Проект ориентирован на стандартный формат экспорта Daylio, который имеет следующую структуру:
```
full_date,date,weekday,time,mood,activities,note_title,note
```

График настроения строится на основе колонок `full_date` (дата) и `mood` (настроение).

## Устранение неполадок

1. **Бот не отвечает**
   - Проверьте правильность токена в файле `.env`
   - Убедитесь, что оба контейнера запущены: `docker compose ps`
   
2. **Ошибки при загрузке файла**
   - Проверьте формат CSV-файла
   - Убедитесь, что директория `data` существует и имеет правильные права доступа

3. **Пустой график**
   - Проверьте структуру файла mood.csv
   - Убедитесь, что значения настроения корректно парсятся скриптом
